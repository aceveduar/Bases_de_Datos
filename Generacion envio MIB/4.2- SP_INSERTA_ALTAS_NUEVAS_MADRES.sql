 CREATE OR REPLACE PROCEDURE SP_INS_ALTAS_ENV_NUEVA_MADRES
AS
CURSOR CTO_CUR IS
  SELECT CONCALT,CONNOM,CONAP1,CONAP2,CONVIA,CONNVIA,CONNUEX,CONNUIN,CONEDIF,
       CONMANZ,CONLOTE,CONCOLO,CONCPO,CONPOB,CONUHA,CONENTR,DUP,CONENVIO,
       CONSUSCRIP,CONOFCR,CONEDO
FROM MP_PRMALTASM
WHERE CONENVIO IS NULL
AND CONMAR=50
AND CONPRM=1
--CAMBIARA FECHAS A MES ANTERIOR-----
AND   CONFALT BETWEEN '01/11/18' AND '30/11/18'
AND   FECHA_ACT BETWEEN '01/11/18' AND '30/11/18';

 CTO_REC CTO_CUR%ROWTYPE;

BEGIN

OPEN CTO_CUR;

  LOOP
   FETCH CTO_CUR INTO CTO_REC;
    EXIT WHEN CTO_CUR%NOTFOUND;

 BEGIN

     INSERT INTO ALTAS(CON_ID,CONNOM,CONAP1,CONAP2,CONTIPO,CONNVIA,CONNUEX,CONNUIN,
                  CONEDIF,CONMANZ,CONLOTE,CONPOBA,CONCPO,CONMUNI,CONUHA,CONENTR,DUP,
                  NUM_COD,CONSUS,CONADM,CONEDO,CONTPER)
     VALUES (CTO_REC.CONCALT,CTO_REC.CONNOM,CTO_REC.CONAP1,CTO_REC.CONAP2,CTO_REC.CONVIA,
            CTO_REC.CONNVIA,CTO_REC.CONNUEX,CTO_REC.CONNUIN,CTO_REC.CONEDIF,
            CTO_REC.CONMANZ,CTO_REC.CONLOTE,CTO_REC.CONCOLO,CTO_REC.CONCPO,CTO_REC.CONPOB,CTO_REC.CONUHA,
            CTO_REC.CONENTR,CTO_REC.DUP,CTO_REC.CONENVIO,CTO_REC.CONSUSCRIP,CTO_REC.CONOFCR,CTO_REC.CONEDO,'1H');

     EXCEPTION WHEN OTHERS THEN

           NULL;

  END;

END LOOP;

  CLOSE CTO_CUR;

     DELETE FROM ALTAS
      WHERE CON_ID IN (SELECT CONCALT FROM MP_PRMALTASM
                 WHERE CONCALT=CON_ID
                 AND ID_RAZON_ACT IN (2,3));

      COMMIT;

END;


----------------------------------------------------------------------------

SELECT CONTPER, COUNT(*)
FROM ALTAS
GROUP BY CONTPER
/

DELETE FROM ALTAS
WHERE CONTPER = '1H'
AND NUM_COD = 2
AND ROWNUM <= 9741
/

SELECT COUNT(*)
FROM ALTAS
/
