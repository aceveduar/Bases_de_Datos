CREATE OR REPLACE PROCEDURE SP_ACT_ESTADO
AS

CURSOR DIR_CURSOR IS

SELECT P.PROIDE,P.CODESTADO,P.CONEDO,P.PROCPO
FROM 
MP_PROFESIONAL  P;

 DIR_REC DIR_CURSOR%ROWTYPE;

 CANT NUMBER;
 ESTABR VARCHAR2(6);	
    
BEGIN

OPEN DIR_CURSOR;
	
  LOOP 
   FETCH DIR_CURSOR INTO DIR_REC;
    EXIT WHEN DIR_CURSOR%NOTFOUND;

       BEGIN

      SELECT DISTINCT(EST_ABR) INTO ESTABR
         FROM CODIGO_POSTAL
          WHERE CODIGO_POSTAL=DIR_REC.PROCPO;          

        EXCEPTION WHEN OTHERS THEN

             ESTABR:=NULL;          
       
      END ;
   
      IF ESTABR IS NOT NULL THEN
            
            UPDATE MP_PROFESIONAL
            SET CONEDO=ESTABR
            WHERE PROIDE=DIR_REC.PROIDE;
          
      END IF;   
		      	
END LOOP;

  CLOSE DIR_CURSOR;

    COMMIT;
	                                
END;
